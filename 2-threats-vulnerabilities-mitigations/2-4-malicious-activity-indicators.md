# 2.4 Given a scenario, analyze indicators of malicious activity
Na podstawie podanego scenariusza, zidentyfikuj i przeanalizuj czynniki wskazujące na złośliwe działania.
# Malware attacks
***Malicious software* (w skrócie *malware*), czyli złośliwe/szkodliwe oprogramowanie, definiuje ogół programów komputerowych, których celem jest zazwyczaj wyrządzenie szkód w systemie komputerowym oraz działanie na niekorzyść jego użytkowników**.

Pamiętajmy jednak, że programista to też człowiek i zdarza się jemu (lub jej) popełniać błędy, więc może dojść do sytuacji, gdzie aplikacja *niechcący narozrabia*. Oprogramowanie zawierające niezamierzone błędy (ang. *bugs*), które mogą spowodować nieplanowane szkody, nie podpada pod definicję złośliwego oprogramowania.

Istnieje wiele odmian złośliwego oprogramowania. Jedne umożliwiają zdalny dostęp do zainfekowanego systemu, inne zbierają wrażliwe dane, a jeszcze inne robią *rozpierduchę* w systemie plików.

Jak zapewne zauważycie, prawie wszystkie przedstawione niżej kategorie nachodzą na siebie w dużym stopniu. Przykładowo, w większości przypadków *ransomware* (dosłownie: program szantażujący) jest jednocześnie złośliwym oprogramowaniem szyfrującym - *cryptomalware*. Wiele wymienionych tutaj rodzajów posiada też cechy wirusa komputerowego. 

Prawdopodobne jest również ryzyko, że infekcja jednym rodzajem oprogramowania może skutkować instalacją kolejnych typów. Przykładowo, nasz system może mieć podatność (ang. *vulnerability*), którą wykorzystuje jakiś robak (*worm*). Kiedy ten dostanie się do systemu i zainstaluje bez naszej wiedzy *tylną furtkę* (*backdoor*), ktoś nam nieprzychylny (dajmy na to twórca robaka) ma od teraz zdalny dostęp do naszej maszyny. W tym momencie możliwe jest zdalne ściągnięcie i uruchomienie kolejnej porcji złośliwego kodu, który na przykład zaszyfruje nasze dane (*ransomware*) lub przyłączy nas do sieci *botnet*.
## Ransomware
W dobie powszechnej cyfryzacji, dane, które posiadamy mogą być dla nas bardzo cenne. Ważne dokumenty zapisane na dysku, nagrania z dorastającym dzieckiem czy nawet zdjęcia z wakacji są dla nas często wartościowym zasobem, którego utrata może bardzo mocno zaboleć. Nie wspominając o danych firm i innych organizacji, których utrata może doprowadzić nawet do wielomilionowych strat finansowych. Mowa tutaj o tajnych informacjach dotyczących strategii, danych osobowych klientów i pracowników (PII = *Personally Identifiable Information*) czy też danych finansowych.

Niestety, cyberprzestępcy zorientowali się, że niektórzy są w stanie słono zapłacić, żeby tylko nie utracić swoich wartościowych danych. Tak właśnie narodziło się ***ransomware*, czyli złośliwe oprogramowanie blokujące użytkownikowi dostęp do jego danych i żądające zapłaty w zamian za odblokowanie tych danych**. **Innymi słowy, jest to żądanie okupu (ang. *ransom*) w zamian za odzyskanie dostępu do swoich zasobów**. W dosłownym tłumaczeniu jest to *oprogramowanie szantażujące* lub *oprogramowanie wymuszające okup*.

Sposób działania takiego oprogramowania może być bardzo różny. Zazwyczaj jest to trojan lub robak (ang. *worm*), który dostaje się do systemu operacyjnego przez naszą nieuwagę lub niezałataną lukę bezpieczeństwa, a następnie próbuje zablokować dostęp do systemu i danych. Jednocześnie informuje nas, że trzeba będzie, kolokwialnie mówiąc, *wyskoczyć z kasy*.

Oprócz odpowiedniej techniki uniemożliwienia dostępu do danych, bardzo istotnym elementem (jeśli nie najważniejszym) jest bezpieczny dla atakującego oraz trudny do namierzenia system płatności. W związku z tym często wykorzystuje się wiadomości SMS o podwyższonej opłacie; rozwiązania typu *pre-paid* (np. [paysafecard](https://www.paysafecard.com/)) czy też popularną kryptowalutę Bitcoin (podobno niektóre firmy nawet [gromadzą środki w postaci Bitcoinów w ramach planu awaryjnego](https://bravenewcoin.com/insights/large-uk-businesses-holding-bitcoin-to-pay-ransoms)).

To w jaki sposób użytkownik zostaje *odcięty* od swoich plików zależy od rodzaju *ransomware’u*. Najprostszą formą jest założenie prostej blokady na system i wyświetlenie użytkownikowi odpowiedniej informacji o konieczności zapłaty (np. *organy ścigania Policji wykryły na tym komputerze nielegalne oprogramowanie i w związku z tym komputer został zablokowany – prosimy o uiszczenie grzywny w wysokości 1000 zł celem odblokowania systemu*).

Zazwyczaj blokada systemu polegała na podmianie ścieżki do powłoki systemu Windows (ang. *[Windows shell](https://en.wikipedia.org/wiki/Windows_shell)*), czyli bazowym programie uruchamianym tuż po zalogowaniu się użytkownika i odpowiadającym za graficzny interfejs systemu (m.in. pulpit, pasek zadań). Jeśli uruchomimy edytor rejestru systemowego (*regedit.exe*) w jednym z nowszych systemów Windows i przejdziemy do klucza `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell`, zobaczymy, że ten ma wartość `explorer.exe`. Oznacza to, że aktualną powłoką systemową jest program *[Windows File Explorer](https://en.wikipedia.org/wiki/Windows_File_Explorer)*, ale można go podmienić na inny, na przykład taki co blokuje pełne uruchomienie systemu i żąda okupu.

W skrajnych przypadkach, oprogramowanie typu *ransomware* może przyjąć formę wspomnianego wcześniej *wirusa dyskowego* i zmodyfikować główny sektor rozruchowy na dysku. W takim przypadku system operacyjny w ogóle nie będzie w stanie prawidłowo wystartować.

Stosunkowo często zdarzało się, że blokady opisane powyżej można było zdjąć, bez utraty danych, jeśli posiadało się odpowiednią wiedzę techniczną. Nawet jeśli trzeba było sformatować cały dysk celem usunięcia zainstalowanego szkodnika, to mieliśmy dostęp do naszych danych choćby za pośrednictwem systemów typu [Live CD](https://en.wikipedia.org/wiki/Live_CD) (system operacyjny na zewnętrznym nośniku danych, posiadający swój własny program rozruchowy)**. Kiedy jednak przestępcy zorientowali się, że zwykłe oszustwa ([*hoax*](https://vilya.pl/sy0-601-cheatsheet-1-1-social-engineering/#hoax)) oraz względnie proste metody blokowania dostępu do systemu stały się niewystarczające, sięgnęli po broń cięższego kalibru. Zaczęli szyfrować dane, żądając zapłaty za ich odszyfrowanie** – tak powstała kolejna forma złośliwego oprogramowania, czyli ***cryptomalware***.
## Trojan
*Timeo Danaos et dona ferentes*, czyli po łacińsku: *obawiam się Greków, nawet gdy przynoszą dary*. Tak napisał rzymski poeta Wergiliusz w swoim poemacie *Eneida*, nawiązując do fortelu przygotowanego przez Greków podczas wojny trojańskiej. Chodzi oczywiście o słynnego ***konia trojańskiego***, czyli drewnianą konstrukcję w kształcie konia, w której ukryli się greccy wojownicy, zaraz po pozornym wycofaniu się z oblężenia Troi. Obrońcy miasta, nie spodziewając się podstępu, wciągnęli konia za mury co ostatecznie doprowadziło do ich klęski. Ukryci w drewnianym koniu żołnierze otworzyli nocą bramy, tym samym umożliwiając Grekom zdobycie miasta.

Niezależnie od tego czy koń trojański istniał naprawdę, czy jest to tylko fikcja literacka, stał się tak popularny, że dzisiaj jest synonimem podarunku skrywającego zgubę i podstęp. W świecie IT określenie ***koń trojański*** (lub w skrócie ***trojan***), ma identyczne znaczenie. **Jest to złośliwe oprogramowanie, które podszywa się pod użyteczne bądź ciekawe aplikacje, ukrywając przed użytkownikiem swoje szkodliwe funkcje**. Krótko mówiąc, kiedy wydaje nam się, że właśnie instalujemy fajną grę komputerową, być może właśnie autoryzowaliśmy bezwiednie instalację złośliwego oprogramowania w naszym systemie. Co więcej, gra rzeczywiście może się uruchomić, ale równocześnie został wykonany złośliwy kod, który jest w stanie nam zaszkodzić w ten czy inny sposób.

Typowe zagrożenia związane z działalnością trojanów są następujące:
- Ukrywanie się przed oprogramowaniem antywirusowym bądź jego całkowita neutralizacja. To samo tyczy się pozostałych programów zabezpieczających (np. firewall).
- Instalacja *tylnej furtki* (ang. *backdoor*) w systemie, w celu umożliwienia bezpośredniego dostępu do zainfekowanej maszyny nieuprawnionej osobie bądź aplikacji. Dzięki takiej furtce atakujący jest w stanie uzyskać dostęp do systemu bez procesu uwierzytelnienia, co z kolei umożliwia przyłączenie zaatakowanej stacji roboczej do sieci botnet, która rozsyła spam lub przeprowadza ataki DDoS (ang. *Distributed Denial of Service*).
- Wyświetlanie niechcianych reklam, np. poprzez podmianę strony startowej w przeglądarkach internetowych lub instalację oprogramowania typu *[adware](https://en.wikipedia.org/wiki/Adware)*.
- Instalacja oprogramowania szpiegującego (ang. *spyware*) oraz wykradanie poufnych danych użytkownika.
- Działania destrukcyjne, takie jak usuwanie plików czy szyfrowanie danych (*ransomware/cryptomalware*).
- Instalacja innych typów złośliwego oprogramowania.
## Worm
W odróżnieniu od *standardowych* wirusów, **robak (ang. *worm*) jest w stanie sam się replikować, bez ingerencji użytkownika.** Innymi słowy, może pojawić się w naszym systemie, nawet jeśli nie wykonamy żadnego ruchu (otwarcie zakażonego pliku czy odwiedzenie zainfekowanej witryny).

Jest to możliwe, ponieważ **robaki wykorzystują różne niezałatane luki bezpieczeństwa w systemach operacyjnych, usługach sieciowych lub aplikacjach**. **Dzięki temu są w stanie samodzielnie rozprzestrzeniać przez sieć, od komputera do komputera**. Wystarczy, że znajdzie maszynę z odpowiednią podatnością, do wykorzystania której został zaprogramowany. Brak konieczności udziału użytkownika do dalszej ekspansji powoduje, że tego typu _szkodniki_ rozprzestrzeniają się dużo szybciej niż standardowe wirusy.

Jako że robaki rozprzestrzeniają się głównie przez sieć, mogą być w pewnych przypadkach powstrzymane, oprócz oprogramowania antywirusowego, przez zapory sieciowe (ang. _firewalls_) oraz przez systemy wykrywania/prewencji włamań IDS/IPS.
## Spyware
***Spyware*, czyli programy szpiegujące zbierające dane użytkownika bez jego wiedzy**. Może to być zwyczajne śledzenie poczynań (np. poprzez rejestrowanie naciśniętych klawiszy) celem zbudowania profilu, który później zostanie sprzedany nieuczciwym reklamodawcom, a w ekstremalnych przypadkach kradzież poufnych informacji, takich jak dane logowania. Do szpiegowania również można wykorzystać technikę [*browser hijacking*](https://en.wikipedia.org/wiki/Browser_hijacking).
## Bloatware
TBD
## Virus
Istnieje wiele odmian złośliwego oprogramowania, które można podpiąć pod definicję wirusa komputerowego, ale mają jednak pewne cechy charakterystyczne, pozwalające na umieszczenie ich w osobnej kategorii. **Wirus komputerowy** jest natomiast pojęciem bardzo ogólnym.

Wirusem nazywamy złośliwe oprogramowanie, które jest w stanie **samodzielnie się powielać poprzez infekowanie innych plików, ale do zainicjowania procesu replikacji i wykonania pozostałych wpisanych procedur wymagane jest działanie użytkownika**, takie jak np. uruchomienie zainfekowanego pliku. Ręczna interwencja jest elementem odróżniającym wirusy od robaków komputerowych (ang. *worms*), które potrafią rozprzestrzeniać się bez udziału użytkownika.

To do czego wirus jest zdolny (oprócz replikacji) zależy od intencji, umiejętności i wyobraźni jego autora. Niektóre wirusy cechują się bardzo małą szkodliwością, ponieważ zostały napisane tylko dla zabawy lub ewentualnie ich celem jest wyświetlanie irytujących reklam ([*adware*](https://en.wikipedia.org/wiki/Adware)). W takim przypadku, jesteśmy narażeni jedynie na zauważalny spadek wydajności systemu.

Inne wirusy mogą się dobrze przed nami ukryć oraz zbierać o nas informacje, wliczając te wrażliwe, bez naszej wiedzy (*spyware*). Dlatego tak istotne jest korzystanie z dobrego antywirusa z aktualną bazą danych - bez tego możemy przez bardzo długi okres nie zorientować, że nasz system jest zainfekowany, a my jesteśmy pod stałą obserwacją. Oczywiście należy pamiętać o tym, że nawet najlepszy antywirus na rynku może okazać się niewystarczający jeśli *złapiemy* całkiem nowego wirusa, którego sygnatury jeszcze nie zostały rozpracowane przez specjalistów.

Kolejną grupę stanowią wirusy o bardzo wysokim stopniu złośliwości, które są w stanie spowodować nieodwracalne szkody, takie jak zniszczenie lub zaszyfrowanie naszych danych. Dawniej, niektóre wirusy mogły doprowadzić nawet do problemów ze sprzętem (ang. *hardware*) -  więcej informacji na ten temat można znaleźć w tym artykule: [Can a virus damage computer hardware?](https://www.computerhope.com/issues/ch001119.htm).

Niektóre źródła podają również osobną kategorię na wirusy infekujące telefony komórkowe lub inne urządzenia mobilne, jednak taka klasyfikacja jest niezbyt dokładna. Oczywiście, istnieje złośliwe oprogramowanie dedykowane na urządzenia mobilne (np. oprogramowanie szpiegujące), ale nie spełnia ono kryteriów wirusa komputerowego.

Poniżej znajdziemy próbę sklasyfikowania wirusów, opierając się o zasady ich funkcjonowania. Należy jednak pamiętać, że konkretny wirus, w wielu przypadkach, zalicza się do więcej niż jednej kategorii.
### Wirusy plikowe/aplikacji
Ich działanie polega na dopisywaniu swojego kodu do istniejących plików wykonywalnych lub całkowitym nadpisywaniu tych plików (w takim przypadku oryginalna zawartość pliku jest raczej nie do odzyskania). Po uruchomieniu zainfekowanego pliku wirus rozpoczyna wykonywanie swoich zaprogramowanych procedur.

Same wirusy plikowe można podzielić na podkategorie, określające w jaki sposób kod wirusa jest dopisywany do oryginalnego pliku (np. na jego końcu, w nagłówku etc.), ale jest to temat mocno wykraczający poza podstawy wymagane na egzaminie, więc tylko o tym wspominam.

Ciekawostką jest fakt, że modyfikacja infekowanych plików może znacząco zwiększyć ich rozmiar, więc za dobrze napisane wirusy uważa się takie, które wykonują swoje zadania zachowując jednocześnie niewielki rozmiar (przy użyciu mniejszej ilości kodu).
### Wirusy dyskowe/sektorów rozruchowych
Dzisiaj już rzadko spotykane wirusy, które zamiast modyfikować pliki, zapisują się w [sektorach rozruchowych](https://en.wikipedia.org/wiki/Boot_sector) (ang. *boot sectors*) nośników pamięci. Wirus aktywuje się w chwili odczytania zawartości zainfekowanego sektora, np. podczas uruchamiania się systemu operacyjnego komputera.
### Wirusy skryptowe
Ta kategoria obejmuje **wirusy napisane w językach skryptowych**, takich jak *JavaScript* (JS), *Visual Basic Script* (VBS), *Visual Basic for Application* (VBA) czy nawet *Python*. Generalnie dużo prościej jest stworzyć takiego wirusa, w porównaniu z opisanymi wcześniej wirusami plikowymi, ponieważ tutaj **operujemy językiem wysokiego poziomu, który jest interpretowany, a nie kompilowany**. 

Oznacza to, że do *zarażenia* innych plików skryptowych nie musimy znać struktury binarnych plików wykonywalnych, ponieważ pliki skryptowe zawierają jawny tekst (kod skryptu). Wystarczy więc *dokleić* złośliwy kod (również w postaci tekstowej) do zawartości wybranych skryptów.

Niektórzy mogą zastanawiać się, w jaki sposób zwykły skrypt JS może nam zaszkodzić - przecież taki kod jest wykonywany tylko w kontekście przeglądarki. Okazuje się, że niekoniecznie. Nawet pomijając fakt, że przeglądarka może mieć pewne podatności, które umożliwią *przebicie się* do systemu, to w systemie Windows funkcjonuje usługa o nazwie [Windows Script Host](https://en.wikipedia.org/wiki/Windows_Script_Host). Jest to systemowe środowisko do interpretacji i uruchamiania skryptów w określonych językach – domyślnie są to VBS (*Visual Basic Script*) oraz JScript (odmiana JavaScript opracowana przez Microsoft). Teoretycznie jest to usługa rzadko wykorzystywana i może stanowić poważne zagrożenie bezpieczeństwa, dlatego często zaleca się jej [wyłączenie](https://pl.ccm.net/faq/8621-jak-wylaczyc-windows-script-host).

Na końcu warto wspomnieć o **wirusach makr** (tzw. *makrowirusach*), które działają wewnątrz środowiska innego programu. Bardzo często rozbudowane aplikacje umożliwiają swoim użytkownikom rozszerzenie funkcjonalności za pomocą wybranego języka skryptowego. Taki skrypt, rozszerzający funkcjonalność podstawową, nazywamy *makrem*. Najbardziej popularne są złośliwe makra napisane w języku VBA (*Visual Basic for Application*), rezydujące w dokumentach pakietu MS Office (dokumenty Word, arkusze kalkulacyjne Excel, prezentacje PowerPoint itp.).
### Wirusy nierezydentne
W przypadku wirusów nierezydentnych (ang. *non-resident virus*), **po uruchomieniu zainfekowanego pliku, kod wirusa *ładuje się* do pamięci operacyjnej, uruchamia się i wyszukuje kolejne obiekty do zarażenia, przeszukując drzewo katalogów w naszym systemie. Po wykonaniu swoich czynności, sterowanie jest przekazywane z powrotem do zainfekowanej aplikacji** - nosiciela (ang. *host application*). 

**Wirus wykonuje swoje instrukcje tak długo, jak długo w pamięci działa proces oryginalnej aplikacji**. Ponieważ kod wirusa wykonuje się przed startem pierwotnej aplikacji, często możemy zauważyć duże opóźnienia zanim właściwy program się uruchomi. Poza tym, możemy również odnotować wzmożoną aktywności nośników danych, ponieważ wirus infekuje inne pliki znalezione na dysku.
### Wirusy rezydentne
**Wirus rezydentny** (ang. *resident virus*) charakteryzuje się bardziej wyrafinowaną techniką działania. W odróżnieniu od wirusa nierezydentnego, ten **rezyduje w pamięci RAM jako proces w tle**, nawet po zakończeniu działania oryginalnego programu i korzysta z systemu przerwań (podobnie jak [programy rezydentne TSR](https://en.wikipedia.org/wiki/Terminate-and-stay-resident_program)).

Dzięki tej technice jest w stanie ukryć swój kod przed programami zarządzającymi pamięcią. Warto jeszcze dodać, nie wchodząc w szczegóły techniczne, że wirusy rezydentne można podzielić na ***szybkie*** (ang. *fast infectors*), których celem jest jak najszybsze zainfekowanie jak największej ilości plików, oraz ***wolne*** (ang. *slow infectors*), którym zależy na jak najdłuższym unikaniu wykrycia kosztem szybkości rozprzestrzeniania się infekcji.
### Fileless virus
W dosłownym tłumaczeniu jest to *wirus bezplikowy* (ang. *fileless virus*). **W odróżnieniu od standardowych wirusów, opisanych powyżej, ten nie zaraża plików zapisanych na fizycznym nośniku danych i jest obecny jedynie w pamięci operacyjnej RAM**, przez co jest bardzo trudny do wykrycia, nawet przez oprogramowanie antywirusowe.

Na pierwszy rzut oka jest bardzo podobny do wirusów rezydentnych, gdyż one również działają w pamięci operacyjnej, niezależnie od zarażonej aplikacji bazowej (*host application*). Istotną różnicą jest jednak fakt, że **wirusy *bezplikowe* w ogóle nie infekują fizycznych plików**.

Określenie *bezplikowy* (ang. *fileless*) sugeruje, że wirus tego typu nie potrzebuje żadnych plików do swojego działania. To stwierdzenie nie jest do końca prawdziwe (podobnie jak [*serverless computing*](https://www.computerworld.pl/news/Serverless-computing-Mniej-administratorow-wiecej-programistow,416692.html) nie oznacza braku serwerów :)).

O ile sam kod wirusa nie musi być zapisany w żadnym pliku, to jednak coś musi umieścić jego kod w pamięci operacyjnej celem wykonania. Wspomniane _coś_ to zazwyczaj zaufana aplikacja (plik wykonywalny), która została w podstępny sposób wykorzystana do ściągnięcia i uruchomienia złośliwego kodu, bez jego zapisywania. Jest to również przyczyna tego, że ten rodzaj złośliwego oprogramowania jest bardzo trudny do zidentyfikowania - antywirus nie wykryje zainfekowanych plików, bo ich po prostu nie ma, a w systemowym menadżerze zadań będzie widoczny jedynie proces zaufanej aplikacji, bez informacji jakie procedury tak naprawdę wykonuje.

Teoretycznie ten typ wirusa może pojawić się w każdym systemie operacyjnym, jednak znacznie **częściej atakowany jest system Microsoft Windows**. Pomijając fakt, że jest najpopularniejszym systemem operacyjnym wśród *zwykłych* użytkowników, posiada on potężne narzędzie w postaci interpretera poleceń **PowerShell** (**PS**), który umożliwia niemalże pełną kontrolę nad systemem wyłącznie za pomocą interfejsu tekstowego (pojedyncze polecenia oraz skrypty).

To wszystko powoduje, że PowerShell jest idealnym kandydatem do aplikacji będącej nośnikiem złośliwego kodu. Nie dość, że za pomocą poleceń PS można zrobić prawie wszystko, to jeszcze na liście menadżera zadań będzie widoczny tylko niepozorny proces _Windows PowerShell_, nawet jeśli właśnie wykonuje złośliwy skrypt w pamięci.

Okazuje się, że koncepcja takich wirusów nie jest nowa, a ich popularność wzrosła w roku 2017. Stało się to za sprawą rozwoju narzędzi, które znacznie ułatwiły ataki tego typu. Przykładem takiego narzędzia jest framework [Empire](https://github.com/BC-SECURITY/Empire) (wcześniej [PowerShell Empire](https://www.youtube.com/watch?v=IefYMsEFyWU)), automatyzujący szereg czynności wykonywanych już po włamaniu (ang. *post-exploitation*), czy też [PowerSploit](https://gitlab.com/kalilinux/packages/powersploit), który agreguje różne moduły PowerShell przydatne podczas testów penetracyjnych.

Przyjrzyjmy się teraz w jaki sposób można *złapać* wirusa *bezplikowego*, na przykładzie systemu operacyjnego Windows z wykorzystaniem możliwości PowerShell:
1. Zakładając, że jesteśmy na tyle ostrożni, żeby nie uruchamiać od razu skryptów PS (`*.ps1`) nieznanego pochodzenia, atakujący (*bad actor*) musi nas najpierw zwabić w pułapkę. Na przykład za pomocą ataku phishingowego może nas skłonić do odwiedzenia określonej witryny internetowej.
2. Strona docelowa zawiera złośliwe oprogramowanie, które jest w stanie wykorzystać luki bezpieczeństwa w naszej przeglądarce internetowej bądź we wtyczkach przez nią używanych (szczególnie kiedy z uporem maniaka wciąż używamy przestarzałych technologii, takich jak Adobe Flash Player czy kontrolki ActiveX). W przypadku krytycznej podatności, jaką jest możliwość zdalnego wykonania kodu (RCE = *Remote Code Execution*), exploit będzie w stanie uruchomić proces PS z zestawem poleceń, które np. ściągną właściwy złośliwy skrypt i od razu wykonają polecenia w nim zawarte. Innymi słowy, wirus rezyduje już w pamięci i realizuje swoje procedury.
3. Ponieważ kod wirusa znajduje się tylko w pamięci, to po wyłączeniu systemu operacyjnego po prostu zniknie, więc musi sobie jakoś zapewnić przetrwanie. Dlatego zazwyczaj taki wirus modyfikuje rejestr systemu i dopisuje swój kod do autostartu. Jeśli jest stosunkowo krótki, to może umieścić swoje procedury w kluczu rejestru, ale w przypadku bardziej rozbudowanego kodu może ukryć się gdzieś na dysku w postaci skryptu uruchamianego podczas startu systemu. Taki skrypt nie jest tym samym co zarażony plik, więc dalej umownie traktujemy to jako *fileless malware*.
4. Przy starcie systemu zapisany wcześniej kod wirusa ponownie uruchamia się jako skrypt PowerShell, kontynuując swoją destruktywną działalność.

Ponieważ ataki tego typu stały się charakterystyczne dla systemu Windows, Microsoft specjalnie dostosował swojego wbudowanego w system antywirusa *Windows Defender*, żeby ten był w stanie wykrywać podejrzane czynności w skryptach PowerShell oraz w usłudze [WMI (*Windows Management Instrumentation*)](https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page), oferującej zdalne zarządzanie systemem.

Dodatkowo, dla interpretera PowerShell można skonfigurować tzw. [polityki wykonania](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2) (ang. *execution policies*), czyli mechanizmy bezpieczeństwa, które są w stanie kontrolować warunki w jakich PS ładuje pliki konfiguracyjne i uruchamia skrypty (np. w przypadku osobistych wersji systemu Windows, domyślna polityka to [*Restricted*](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2#restricted), która zezwala jedynie na uruchamianie pojedynczych poleceń, ale blokuje wykonanie jakiegokolwiek skryptu).
## Keylogger
TBD
## Logic bomb
TBD
## Rootkit
TBD
# Materiały źródłowe
- [Professor Messer’s CompTIA SY0-701 Security+ Training Course](https://www.professormesser.com/security-plus/sy0-701/sy0-701-video/sy0-701-comptia-security-plus-course/)
- [CompTIA Security+ Study Guide SY0-701, Mike Chapple, David Seidl](https://www.amazon.com/CompTIA-Security-Study-Practice-Questions/dp/1394211414)
- [Fileless malware attacks explained (with examples)](https://www.comparitech.com/blog/information-security/fileless-malware-attacks/)